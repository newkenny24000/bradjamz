<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <title>8-Track Multi-Instrument Studio</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <!-- Track Controls Section -->
    <div class="track-controls">
        <div class="controls-header">
            <h3>Track Controls</h3>
            <button id="minimize-controls" title="Minimize controls for full screen">‚è∏Ô∏è</button>
        </div>
        <div class="track-control-row" data-track="0">
            <select class="track-selector" data-track="0">
                <option value="synth">Synth</option>
                <option value="piano">Piano</option>
                <option value="strings">Strings</option>
                <option value="bells">Bells</option>
                <option value="bass">Bass</option>
                <option value="lead">Lead</option>
                <option value="pad">Pad</option>
                <option value="pluck">Pluck</option>
                <option value="organ">Organ</option>
                <option value="flute">Flute</option>
                <option value="brass">Brass</option>
                <option value="choir">Choir</option>
            </select>
            <button class="sound-gen-btn" data-track="0" title="Generate sound from text">üéµ</button>
            <button class="effects-toggle-btn" data-track="0" title="Toggle effects panel">üéõÔ∏è</button>
            <div class="track-effects-panel" data-track="0">
                <div class="effect-control">
                    <label>Reverb</label>
                    <input type="range" class="track-reverb" data-track="0" min="0" max="100" value="30">
                    <span class="effect-value">30</span>
                </div>
                <div class="effect-control">
                    <label>Delay</label>
                    <input type="range" class="track-delay" data-track="0" min="0" max="100" value="0">
                    <span class="effect-value">0</span>
                </div>
                <div class="effect-control">
                    <label>Filter</label>
                    <input type="range" class="track-filter" data-track="0" min="0" max="100" value="50">
                    <span class="effect-value">50</span>
                </div>
                <div class="effect-control">
                    <label>Volume</label>
                    <input type="range" class="track-volume" data-track="0" min="0" max="100" value="70">
                    <span class="effect-value">70</span>
                </div>
                <div class="effect-control">
                    <label>Decay</label>
                    <input type="range" class="track-decay" data-track="0" min="0" max="100" value="10">
                    <span class="effect-value">10</span>
                </div>
            </div>
        </div>
        <div class="track-control-row" data-track="1">
            <select class="track-selector" data-track="1">
                <option value="piano" selected>Piano</option>
                <option value="synth">Synth</option>
                <option value="strings">Strings</option>
                <option value="bells">Bells</option>
                <option value="bass">Bass</option>
                <option value="lead">Lead</option>
                <option value="pad">Pad</option>
                <option value="pluck">Pluck</option>
                <option value="organ">Organ</option>
                <option value="flute">Flute</option>
                <option value="brass">Brass</option>
                <option value="choir">Choir</option>
            </select>
            <button class="sound-gen-btn" data-track="1" title="Generate sound from text">üéµ</button>
            <button class="effects-toggle-btn" data-track="1" title="Toggle effects panel">üéõÔ∏è</button>
            <div class="track-effects-panel" data-track="1">
                <div class="effect-control">
                    <label>Reverb</label>
                    <input type="range" class="track-reverb" data-track="1" min="0" max="100" value="30">
                    <span class="effect-value">30</span>
                </div>
                <div class="effect-control">
                    <label>Delay</label>
                    <input type="range" class="track-delay" data-track="1" min="0" max="100" value="0">
                    <span class="effect-value">0</span>
                </div>
                <div class="effect-control">
                    <label>Filter</label>
                    <input type="range" class="track-filter" data-track="1" min="0" max="100" value="50">
                    <span class="effect-value">50</span>
                </div>
                <div class="effect-control">
                    <label>Volume</label>
                    <input type="range" class="track-volume" data-track="1" min="0" max="100" value="70">
                    <span class="effect-value">70</span>
                </div>
                <div class="effect-control">
                    <label>Decay</label>
                    <input type="range" class="track-decay" data-track="1" min="0" max="100" value="10">
                    <span class="effect-value">10</span>
                </div>
            </div>
        </div>
        <div class="track-control-row" data-track="2">
            <select class="track-selector" data-track="2">
                <option value="strings" selected>Strings</option>
                <option value="synth">Synth</option>
                <option value="piano">Piano</option>
                <option value="bells">Bells</option>
                <option value="bass">Bass</option>
                <option value="lead">Lead</option>
                <option value="pad">Pad</option>
                <option value="pluck">Pluck</option>
                <option value="organ">Organ</option>
                <option value="flute">Flute</option>
                <option value="brass">Brass</option>
                <option value="choir">Choir</option>
            </select>
            <button class="sound-gen-btn" data-track="2" title="Generate sound from text">üéµ</button>
            <button class="effects-toggle-btn" data-track="2" title="Toggle effects panel">üéõÔ∏è</button>
            <div class="track-effects-panel" data-track="2">
                <div class="effect-control">
                    <label>Reverb</label>
                    <input type="range" class="track-reverb" data-track="2" min="0" max="100" value="30">
                    <span class="effect-value">30</span>
                </div>
                <div class="effect-control">
                    <label>Delay</label>
                    <input type="range" class="track-delay" data-track="2" min="0" max="100" value="0">
                    <span class="effect-value">0</span>
                </div>
                <div class="effect-control">
                    <label>Filter</label>
                    <input type="range" class="track-filter" data-track="2" min="0" max="100" value="50">
                    <span class="effect-value">50</span>
                </div>
                <div class="effect-control">
                    <label>Volume</label>
                    <input type="range" class="track-volume" data-track="2" min="0" max="100" value="70">
                    <span class="effect-value">70</span>
                </div>
                <div class="effect-control">
                    <label>Decay</label>
                    <input type="range" class="track-decay" data-track="2" min="0" max="100" value="10">
                    <span class="effect-value">10</span>
                </div>
            </div>
        </div>
        <div class="track-control-row" data-track="3">
            <select class="track-selector" data-track="3">
                <option value="bells" selected>Bells</option>
                <option value="synth">Synth</option>
                <option value="piano">Piano</option>
                <option value="strings">Strings</option>
                <option value="bass">Bass</option>
                <option value="lead">Lead</option>
                <option value="pad">Pad</option>
                <option value="pluck">Pluck</option>
                <option value="organ">Organ</option>
                <option value="flute">Flute</option>
                <option value="brass">Brass</option>
                <option value="choir">Choir</option>
            </select>
            <button class="sound-gen-btn" data-track="3" title="Generate sound from text">üéµ</button>
            <button class="effects-toggle-btn" data-track="3" title="Toggle effects panel">üéõÔ∏è</button>
            <div class="track-effects-panel" data-track="3">
                <div class="effect-control">
                    <label>Reverb</label>
                    <input type="range" class="track-reverb" data-track="3" min="0" max="100" value="30">
                    <span class="effect-value">30</span>
                </div>
                <div class="effect-control">
                    <label>Delay</label>
                    <input type="range" class="track-delay" data-track="3" min="0" max="100" value="0">
                    <span class="effect-value">0</span>
                </div>
                <div class="effect-control">
                    <label>Filter</label>
                    <input type="range" class="track-filter" data-track="3" min="0" max="100" value="50">
                    <span class="effect-value">50</span>
                </div>
                <div class="effect-control">
                    <label>Volume</label>
                    <input type="range" class="track-volume" data-track="3" min="0" max="100" value="70">
                    <span class="effect-value">70</span>
                </div>
                <div class="effect-control">
                    <label>Decay</label>
                    <input type="range" class="track-decay" data-track="3" min="0" max="100" value="10">
                    <span class="effect-value">10</span>
                </div>
            </div>
        </div>
        <div class="track-control-row" data-track="4">
            <select class="track-selector" data-track="4">
                <option value="pad" selected>Pad</option>
                <option value="synth">Synth</option>
                <option value="piano">Piano</option>
                <option value="strings">Strings</option>
                <option value="bells">Bells</option>
                <option value="bass">Bass</option>
                <option value="lead">Lead</option>
                <option value="pluck">Pluck</option>
                <option value="organ">Organ</option>
                <option value="flute">Flute</option>
                <option value="brass">Brass</option>
                <option value="choir">Choir</option>
            </select>
            <button class="sound-gen-btn" data-track="4" title="Generate sound from text">üéµ</button>
            <button class="effects-toggle-btn" data-track="4" title="Toggle effects panel">üéõÔ∏è</button>
            <div class="track-effects-panel" data-track="4">
                <div class="effect-control">
                    <label>Reverb</label>
                    <input type="range" class="track-reverb" data-track="4" min="0" max="100" value="30">
                    <span class="effect-value">30</span>
                </div>
                <div class="effect-control">
                    <label>Delay</label>
                    <input type="range" class="track-delay" data-track="4" min="0" max="100" value="0">
                    <span class="effect-value">0</span>
                </div>
                <div class="effect-control">
                    <label>Filter</label>
                    <input type="range" class="track-filter" data-track="4" min="0" max="100" value="50">
                    <span class="effect-value">50</span>
                </div>
                <div class="effect-control">
                    <label>Volume</label>
                    <input type="range" class="track-volume" data-track="4" min="0" max="100" value="70">
                    <span class="effect-value">70</span>
                </div>
                <div class="effect-control">
                    <label>Decay</label>
                    <input type="range" class="track-decay" data-track="4" min="0" max="100" value="10">
                    <span class="effect-value">10</span>
                </div>
            </div>
        </div>
        <div class="track-control-row" data-track="5">
            <select class="track-selector" data-track="5">
                <option value="lead" selected>Lead</option>
                <option value="synth">Synth</option>
                <option value="piano">Piano</option>
                <option value="strings">Strings</option>
                <option value="bells">Bells</option>
                <option value="bass">Bass</option>
                <option value="pad">Pad</option>
                <option value="pluck">Pluck</option>
                <option value="organ">Organ</option>
                <option value="flute">Flute</option>
                <option value="brass">Brass</option>
                <option value="choir">Choir</option>
            </select>
            <button class="sound-gen-btn" data-track="5" title="Generate sound from text">üéµ</button>
            <button class="effects-toggle-btn" data-track="5" title="Toggle effects panel">üéõÔ∏è</button>
            <div class="track-effects-panel" data-track="5">
                <div class="effect-control">
                    <label>Reverb</label>
                    <input type="range" class="track-reverb" data-track="5" min="0" max="100" value="30">
                    <span class="effect-value">30</span>
                </div>
                <div class="effect-control">
                    <label>Delay</label>
                    <input type="range" class="track-delay" data-track="5" min="0" max="100" value="0">
                    <span class="effect-value">0</span>
                </div>
                <div class="effect-control">
                    <label>Filter</label>
                    <input type="range" class="track-filter" data-track="5" min="0" max="100" value="50">
                    <span class="effect-value">50</span>
                </div>
                <div class="effect-control">
                    <label>Volume</label>
                    <input type="range" class="track-volume" data-track="5" min="0" max="100" value="70">
                    <span class="effect-value">70</span>
                </div>
                <div class="effect-control">
                    <label>Decay</label>
                    <input type="range" class="track-decay" data-track="5" min="0" max="100" value="10">
                    <span class="effect-value">10</span>
                </div>
            </div>
        </div>
        <div class="track-control-row" data-track="6">
            <select class="track-selector" data-track="6">
                <option value="pluck" selected>Pluck</option>
                <option value="synth">Synth</option>
                <option value="piano">Piano</option>
                <option value="strings">Strings</option>
                <option value="bells">Bells</option>
                <option value="bass">Bass</option>
                <option value="lead">Lead</option>
                <option value="pad">Pad</option>
                <option value="organ">Organ</option>
                <option value="flute">Flute</option>
                <option value="brass">Brass</option>
                <option value="choir">Choir</option>
            </select>
            <button class="sound-gen-btn" data-track="6" title="Generate sound from text">üéµ</button>
            <button class="effects-toggle-btn" data-track="6" title="Toggle effects panel">üéõÔ∏è</button>
            <div class="track-effects-panel" data-track="6">
                <div class="effect-control">
                    <label>Reverb</label>
                    <input type="range" class="track-reverb" data-track="6" min="0" max="100" value="30">
                    <span class="effect-value">30</span>
                </div>
                <div class="effect-control">
                    <label>Delay</label>
                    <input type="range" class="track-delay" data-track="6" min="0" max="100" value="0">
                    <span class="effect-value">0</span>
                </div>
                <div class="effect-control">
                    <label>Filter</label>
                    <input type="range" class="track-filter" data-track="6" min="0" max="100" value="50">
                    <span class="effect-value">50</span>
                </div>
                <div class="effect-control">
                    <label>Volume</label>
                    <input type="range" class="track-volume" data-track="6" min="0" max="100" value="70">
                    <span class="effect-value">70</span>
                </div>
                <div class="effect-control">
                    <label>Decay</label>
                    <input type="range" class="track-decay" data-track="6" min="0" max="100" value="10">
                    <span class="effect-value">10</span>
                </div>
            </div>
        </div>
        <div class="track-control-row" data-track="7">
            <select class="track-selector" data-track="7">
                <option value="bass" selected>Bass</option>
                <option value="synth">Synth</option>
                <option value="piano">Piano</option>
                <option value="strings">Strings</option>
                <option value="bells">Bells</option>
                <option value="lead">Lead</option>
                <option value="pad">Pad</option>
                <option value="pluck">Pluck</option>
                <option value="organ">Organ</option>
                <option value="flute">Flute</option>
                <option value="brass">Brass</option>
                <option value="choir">Choir</option>
            </select>
            <button class="sound-gen-btn" data-track="7" title="Generate sound from text">üéµ</button>
            <button class="effects-toggle-btn" data-track="7" title="Toggle effects panel">üéõÔ∏è</button>
            <div class="track-effects-panel" data-track="7">
                <div class="effect-control">
                    <label>Reverb</label>
                    <input type="range" class="track-reverb" data-track="7" min="0" max="100" value="30">
                    <span class="effect-value">30</span>
                </div>
                <div class="effect-control">
                    <label>Delay</label>
                    <input type="range" class="track-delay" data-track="7" min="0" max="100" value="0">
                    <span class="effect-value">0</span>
                </div>
                <div class="effect-control">
                    <label>Filter</label>
                    <input type="range" class="track-filter" data-track="7" min="0" max="100" value="50">
                    <span class="effect-value">50</span>
                </div>
                <div class="effect-control">
                    <label>Volume</label>
                    <input type="range" class="track-volume" data-track="7" min="0" max="100" value="70">
                    <span class="effect-value">70</span>
                </div>
                <div class="effect-control">
                    <label>Decay</label>
                    <input type="range" class="track-decay" data-track="7" min="0" max="100" value="10">
                    <span class="effect-value">10</span>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Minimized Controls Bar -->
    <div class="minimized-controls" style="display: none;">
        <button id="restore-controls" title="Restore track controls">üéõÔ∏è</button>
        <div class="mini-track-indicators">
            <div class="mini-track" data-track="0">1</div>
            <div class="mini-track" data-track="1">2</div>
            <div class="mini-track" data-track="2">3</div>
            <div class="mini-track" data-track="3">4</div>
            <div class="mini-track" data-track="4">5</div>
            <div class="mini-track" data-track="5">6</div>
            <div class="mini-track" data-track="6">7</div>
            <div class="mini-track" data-track="7">8</div>
        </div>
    </div>
    
    <!-- Top Menu Bar -->
    <div class="top-menu">
        <button class="menu-item" id="sounds-menu">Sounds</button>
        <button class="menu-item" id="tracks-menu">Tracks</button>
        <button class="menu-item" id="profile-menu">Profile</button>
        <button class="menu-item" id="panic">Stop All</button>
        <button class="menu-item" id="preset">Presets</button>
        <button class="menu-item" id="view-toggle">Grid View</button>
        <button class="menu-item" id="single-view-toggle">Single Track</button>
    </div>
    
    <!-- Canvas for particle effects -->
    <canvas id="particleCanvas"></canvas>
    
    <!-- Multi-track View -->
    <div class="multi-track-view">
        <!-- Instrument zones overlay -->
        <div class="instrument-zones">
        <div class="instrument-zone" data-track="0">
        </div>
        <div class="instrument-zone" data-track="1">
        </div>
        <div class="instrument-zone" data-track="2">
        </div>
        <div class="instrument-zone" data-track="3">
        </div>
        <div class="instrument-zone" data-track="4">
        </div>
        <div class="instrument-zone" data-track="5">
        </div>
        <div class="instrument-zone" data-track="6">
        </div>
        <div class="instrument-zone" data-track="7">
        </div>
    </div>
    </div>
    
    <!-- Grid Sequencer View -->
    <div class="grid-sequencer" style="display: none;">
        <div class="sequencer-controls">
            <button id="sequencer-play">‚ñ∂ Play</button>
            <button id="sequencer-stop">‚óº Stop</button>
            <button id="sequencer-clear">Clear</button>
        </div>
        <div class="sequencer-grid">
            <!-- Grid will be generated by JavaScript -->
        </div>
    </div>
    
    <!-- Single Track View -->
    <div class="single-track-view" style="display: none;">
        <div class="single-track-header">
            <h3>Single Track Mode</h3>
            <select id="single-track-select">
                <option value="0">Track 1</option>
                <option value="1">Track 2</option>
                <option value="2">Track 3</option>
                <option value="3">Track 4</option>
                <option value="4">Track 5</option>
                <option value="5">Track 6</option>
                <option value="6">Track 7</option>
                <option value="7">Track 8</option>
            </select>
        </div>
        <canvas id="singleTrackCanvas"></canvas>
    </div>
    
    
    <div class="control-panel">
        <div class="panel-header">
            <h3>8-Track Studio Controls</h3>
            <button id="collapse-btn">‚àí</button>
        </div>
        
        <div class="panel-content">
            <div class="controls-row">
                <div class="control-item">
                    <label>Scale</label>
                    <select id="scale">
                        <option value="chromatic">Chromatic</option>
                        <option value="major">Major</option>
                        <option value="minor">Minor</option>
                        <option value="pentatonic">Pentatonic</option>
                        <option value="blues">Blues</option>
                        <option value="arabic">Arabic</option>
                        <option value="japanese">Japanese</option>
                        <option value="wholetone">Whole Tone</option>
                    </select>
                </div>
                
                <div class="control-item">
                    <label>Key</label>
                    <select id="key">
                        <option value="C">C</option>
                        <option value="C#">C#</option>
                        <option value="D">D</option>
                        <option value="D#">D#</option>
                        <option value="E">E</option>
                        <option value="F">F</option>
                        <option value="F#">F#</option>
                        <option value="G">G</option>
                        <option value="G#">G#</option>
                        <option value="A">A</option>
                        <option value="A#">A#</option>
                        <option value="B">B</option>
                    </select>
                </div>
                
                <div class="control-item">
                    <label>Base Octave</label>
                    <input type="range" id="octave" min="1" max="6" value="3">
                    <span id="octaveValue">3</span>
                </div>
                
                <div class="control-item">
                    <label>BPM</label>
                    <input type="range" id="bpm" min="60" max="200" value="120">
                    <span id="bpmValue">120</span>
                </div>
                
                <div class="control-item">
                    <label>Time Sig</label>
                    <select id="timesig">
                        <option value="4/4" selected>4/4</option>
                        <option value="3/4">3/4</option>
                        <option value="6/8">6/8</option>
                        <option value="5/4">5/4</option>
                    </select>
                </div>
                
                <div class="control-item">
                    <label>Metronome</label>
                    <button id="metronome-toggle" class="metro-btn">Off</button>
                </div>
                
            </div>
            
            
            <div class="action-buttons">
                <button id="record">‚óè Record</button>
                <button id="play">‚ñ∂ Play</button>
                <button id="clear">Clear</button>
                <button id="loop-toggle" class="loop-btn">Loop Off</button>
                <button id="preset">Presets</button>
                <button id="panic2">Stop All</button>
                <button id="help">?</button>
            </div>
        </div>
    </div>
    
    <div class="touch-indicators">
        <!-- Touch indicators will be dynamically added here -->
    </div>
    
    <div class="debug-panel">
        <div class="debug-header">
            <span>Debug Log</span>
            <div class="debug-buttons">
                <button id="copy-debug">Copy</button>
                <button id="clear-debug">Clear</button>
            </div>
        </div>
        <div id="debug-log"></div>
    </div>
    
    <div class="preset-menu" style="display: none;">
        <h3>Presets</h3>
        <button class="preset-btn" data-preset="ambient">Ambient Layers</button>
        <button class="preset-btn" data-preset="jazz">Jazz Ensemble</button>
        <button class="preset-btn" data-preset="electronic">Electronic</button>
        <button class="preset-btn" data-preset="orchestral">Orchestral</button>
        <button class="preset-btn" data-preset="rockband">Rock Band</button>
        <button class="preset-btn" data-preset="world">World Music</button>
        <button class="preset-btn" data-preset="experimental">Experimental</button>
        <button class="preset-btn" data-preset="close">Close</button>
    </div>
    
    <div class="help-menu" style="display: none;">
        <h3>How to Play</h3>
        <p>‚Ä¢ 8 tracks, each customizable</p>
        <p>‚Ä¢ Select instrument per track</p>
        <p>‚Ä¢ Touch horizontally for notes</p>
        <p>‚Ä¢ Play multiple tracks at once</p>
        <p>‚Ä¢ 12 different instruments!</p>
        <button class="help-close">Got it!</button>
    </div>
    
    <div class="recording-indicator" style="display: none;">
        ‚óè Recording...
    </div>
    
    <!-- Sound Generation Modal -->
    <div class="sound-gen-modal" style="display: none;">
        <div class="modal-content">
            <h3>Generate Sound for <span id="track-number"></span></h3>
            <div class="api-key-section">
                <label>ElevenLabs API Key:</label>
                <input type="password" id="elevenlabs-api-key" placeholder="Enter your API key">
                <button id="save-api-key">Save</button>
            </div>
            <div class="sound-gen-section">
                <label>Describe the sound you want:</label>
                <textarea id="sound-prompt" placeholder="e.g., 'deep bass drum hit', 'ethereal choir ahh', 'laser synth zap'"></textarea>
                <div class="gen-actions">
                    <button id="generate-sound">Generate</button>
                    <button id="cancel-gen">Cancel</button>
                </div>
                <div class="loading-indicator" style="display: none;">
                    <div class="spinner"></div>
                    <p>Generating sound...</p>
                </div>
            </div>
            <div class="sound-mode-toggle">
                <label>
                    <input type="checkbox" id="use-sample-mode" data-track="">
                    Use generated sample instead of synthesizer
                </label>
            </div>
        </div>
    </div>
    
    <script src="setup-api-key.js"></script>
    <script src="debug.js"></script>
    <script src="audio-engine.js"></script>
    <script src="script.js"></script>
</body>
</html>